# Apache VirtualHost Configuration for Axum API
# Domain: axum.synergyinfinity.id
# Backend: Rust Axum on port 8080

<VirtualHost *:80>
    ServerAdmin webmaster@synergyinfinity.id
    ServerName axum.synergyinfinity.id
    ServerAlias 41ecdf6f.axum.synergyinfinity.id
    
    ErrorLog "/www/wwwlogs/axum.synergyinfinity.id-error_log"
    CustomLog "/www/wwwlogs/axum.synergyinfinity.id-access_log" combined

    # Enable reverse proxy
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Forward all requests to Axum backend on port 8080
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
    
    # Proxy headers for Axum to know the original request
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    RequestHeader set X-Real-IP %{REMOTE_ADDR}s
    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
    
    # Timeout for long-running requests
    ProxyTimeout 300
    
    # WebSocket support (if needed)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:8080/$1 [P,L]
    
    # Security: Deny access to sensitive files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    <Files ~ (\.env|\.git|Cargo\.toml|Cargo\.lock|\.user\.ini|\.htaccess)$>
        Require all denied
    </Files>
</VirtualHost>
